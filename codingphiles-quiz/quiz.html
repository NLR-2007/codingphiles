<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Quiz | CodingPhiles</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Jersey+10&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#020617;
      --panel:rgba(255,255,255,0.05);
      --border:rgba(255,255,255,0.08);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --primary:#1976d2;
      --green:#22c55e;
      --red:#ef4444;
      --yellow:#eab308;
    }

    *{margin:0;padding:0;box-sizing:border-box}

    body{
      font-family:"Nunito",sans-serif;
      background:linear-gradient(135deg,#0f172a,#020617);
      color:var(--text);
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    header{
      padding:16px 30px;
      border-bottom:1px solid var(--border);
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    header h1{
      font-family:"Jersey 10",cursive;
      font-size:34px;
      letter-spacing:2px;
    }

    .timer{
      font-weight:600;
      font-size:16px;
    }

    main{
      flex:1;
      display:grid;
      grid-template-columns:3fr 1fr;
      gap:20px;
      padding:20px;
      max-width:1300px;
      margin:auto;
      width:100%;
    }

    .question-panel{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:14px;
      padding:24px;
    }

    .q-no{
      font-size:14px;
      color:var(--muted);
      margin-bottom:10px;
    }

    .q-text{
      font-size:18px;
      margin-bottom:20px;
    }

    .options label{
      display:block;
      padding:12px;
      margin-bottom:12px;
      border:1px solid var(--border);
      border-radius:10px;
      cursor:pointer;
      transition:.2s;
    }

    .options input{
      display:none;
    }

    .options label:hover{
      background:rgba(255,255,255,0.06);
    }

    .options input:checked + span{
      color:#fff;
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top:20px;
    }

    button{
      padding:10px 18px;
      border-radius:10px;
      border:none;
      cursor:pointer;
      font-weight:600;
    }

    .review{background:var(--yellow);color:#000}
    .clear{background:#334155;color:#fff}
    .next{background:var(--primary);color:#fff}

    .nav-panel{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:14px;
      padding:16px;
      overflow-y:auto;
    }
/* Highlight selected option */
.options label {
  display: block;
  padding: 12px;
  margin-bottom: 12px;
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.options label.selected {
  background: rgba(25,118,210,0.25);
  border-color: #1976d2;
}

    .nav-panel h3{
      margin-bottom:12px;
      font-size:16px;
    }

    .nav-grid{
      display:grid;
      grid-template-columns:repeat(5,1fr);
      gap:8px;
    }

    .nav-btn{
      padding:8px 0;
      border-radius:6px;
      border:none;
      cursor:pointer;
      font-size:13px;
    }

    .unattempted{background:var(--red);color:#fff}
    .attempted{background:var(--green);color:#fff}
    .reviewed{background:var(--yellow);color:#000}

    footer{
      text-align:center;
      padding:14px;
      font-size:12px;
      color:var(--muted);
      border-top:1px solid var(--border);
    }

    @media(max-width:900px){
      main{grid-template-columns:1fr}
    }
  </style>
</head>

<body>

<header>
  <h1>CodingPhiles</h1>
  <div class="timer">
  Quiz: <span id="time">00:00</span> |
  Question: <span id="qTime">00</span>s
</div>

</header>

<main>

  <!-- QUESTION -->
  <div class="question-panel">
    <div class="q-no" id="qNo"></div>
    <div class="q-text" id="qText"></div>

    <div class="options" id="options"></div>

<div class="actions">
  <button class="review" onclick="markReview()">Mark for Review</button>
  <button class="clear" onclick="clearAnswer()">Clear</button>
  <button class="next" onclick="nextQuestion()">Next</button>
  <button class="next" style="background:#16a34a" onclick="confirmSubmit()">Submit Quiz</button>
</div>


  <!-- NAVIGATION -->
  <div class="nav-panel">
    <h3>Questions</h3>
    <div class="nav-grid" id="nav"></div>
  </div>

</main>

<footer>
  Developed by NLR GROUP OF COMPANY
</footer>
<script type="module">
import { questionBank } from "./js/questions.js";

/* ===============================
   LOAD QUIZ CONFIG
=============================== */
const subject = localStorage.getItem("quizSubject");
const difficulty = localStorage.getItem("quizDifficulty");
const count = Number(localStorage.getItem("quizCount"));
const quizTime = Number(localStorage.getItem("quizTime")) || 0;

if (!subject || !difficulty || !count) {
  alert("Quiz configuration missing");
  window.location.href = "dashboard.html";
}

/* ===============================
   LOAD REAL QUESTIONS
=============================== */
let questions = questionBank?.[subject]?.[difficulty];

if (!questions || questions.length === 0) {
  alert(`No questions available for ${subject} (${difficulty})`);
  window.location.href = "dashboard.html";
}

// Shuffle & limit
questions = [...questions].sort(() => Math.random() - 0.5).slice(0, count);

// Save for result & review
localStorage.setItem("quizQuestions", JSON.stringify(questions));

/* ===============================
   QUIZ STATE
=============================== */
let current = 0;
let answers = Array(questions.length).fill(null);
let review = Array(questions.length).fill(false);

/* ===============================
   GLOBAL QUIZ TIMER
=============================== */
let time = quizTime * 60;
const timeEl = document.getElementById("time");

const quizTimer = setInterval(() => {
  const m = String(Math.floor(time / 60)).padStart(2, "0");
  const s = String(time % 60).padStart(2, "0");
  timeEl.textContent = `${m}:${s}`;
  time--;

  if (time < 0) {
    clearInterval(quizTimer);
    clearInterval(questionTimer);
    submitQuiz();
  }
}, 1000);

/* ===============================
   PER-QUESTION TIMER
=============================== */
const QUESTION_TIME = 30;
let qTime = QUESTION_TIME;
let questionTimer;
const qTimeEl = document.getElementById("qTime");

function startQuestionTimer() {
  clearInterval(questionTimer);
  qTime = QUESTION_TIME;
  qTimeEl.textContent = qTime;

  questionTimer = setInterval(() => {
    qTime--;
    qTimeEl.textContent = qTime;
    if (qTime <= 0) {
      clearInterval(questionTimer);
      nextQuestion();
    }
  }, 1000);
}

/* ===============================
   RENDER QUESTION
=============================== */
function renderQuestion() {
  const q = questions[current];

  document.getElementById("qNo").textContent =
    `Question ${current + 1} of ${questions.length}`;
  document.getElementById("qText").textContent = q.question;

  const optBox = document.getElementById("options");
  optBox.innerHTML = "";

  q.options.forEach((opt, i) => {
    const selected = answers[current] === i;
    optBox.innerHTML += `
      <label class="${selected ? "selected" : ""}"
             onclick="selectAnswer(${i}, this)">
        <input type="radio" name="opt" ${selected ? "checked" : ""}>
        <span>${opt}</span>
      </label>
    `;
  });

  updateNav();
  startQuestionTimer();
}

/* ===============================
   ANSWER HANDLING
=============================== */
window.selectAnswer = (i, label) => {
  answers[current] = i;
  review[current] = false;

  document.querySelectorAll("#options label")
    .forEach(l => l.classList.remove("selected"));
  label.classList.add("selected");
};

window.markReview = () => {
  review[current] = true;
  nextQuestion();
};

window.clearAnswer = () => {
  answers[current] = null;
  review[current] = false;
  renderQuestion();
};

window.nextQuestion = () => {
  if (current < questions.length - 1) {
    current++;
    renderQuestion();
  }
};

/* ===============================
   NAV PANEL
=============================== */
function updateNav() {
  const nav = document.getElementById("nav");
  nav.innerHTML = "";

  questions.forEach((_, i) => {
    let cls = "unattempted";
    if (answers[i] !== null) cls = "attempted";
    if (review[i]) cls = "reviewed";

    nav.innerHTML += `
      <button class="nav-btn ${cls}" onclick="goTo(${i})">${i + 1}</button>
    `;
  });
}

window.goTo = (i) => {
  current = i;
  renderQuestion();
};

/* ===============================
   SUBMIT QUIZ
=============================== */
window.confirmSubmit = () => {
  if (confirm("Are you sure you want to submit the quiz?")) submitQuiz();
};

function submitQuiz() {
  clearInterval(quizTimer);
  clearInterval(questionTimer);
  localStorage.setItem("quizAnswers", JSON.stringify(answers));
  window.location.href = "result.html";
}

/* ===============================
   INIT
=============================== */
renderQuestion();
</script>

</body>
</html>
